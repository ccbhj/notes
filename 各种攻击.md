# 各种攻击

1. TCP类:

   1. 随机序号预测攻击:

      攻击者可以通过预测发送方的序号(seq)来伪装成发送端, 给接受端发送攻击包. 

      攻击者需要监听双方的交流, 并从发送的包中预测出tcp的序号, 当预测出来后, 需要对发送端启动另一次攻击(如DDos)来使他无法发送包, 

      #### 解决办法: 

      - 用更复杂, 难以预测的函数生成随机序号
      - 将路由或者防火墙设置为只允许内网ip, 使得外人无法预测ip地址

   2. TCP 洪流攻击(SYN flood):

      攻击者用无效的ip地址向接收端发起第一次握手, 接收端收到之后开始分配tcp相关的结构内存等, 然后发送SYN-ACK第二次握手, 而攻击者不回复(假ip地址无法回复)ACK(第三次握手), 导致接收端需要等待63秒超时(linux超时5次, 1, 2, 4, 8, 16, 32), 使得接收端内存不足或者端口不足, 无法接收别的连接

      #### 解决方法:

      - 过滤ip地址, 用黑名单或者白名单过滤无效的ip地址

      - syn cookies: 

        将SYN连接结构编码成序列号, 而不是直接分配内存, 然后放在第二次握手里面发送给发起端, 如果发起端可以连接就将序列号编码发送回来, 然后再根据这个序列号生成对应的tcp控制结构,

      - syn  cache:

        收到第二次握手后不分配tcp控制结构, 而是将这个半开的连接保存在一个hash表里面, 收到第三次握手后再从中取出进行分配内存

      - 复用最老的半关闭连接

      - 减少第二次握手超时的时间

      

2. 网页类:

   1. XSS(跨站脚本攻击):

      通过以特定形式(如表单)注入恶意脚本, 以收集cookies等等恶意操作

      #### 解决办法:

      - 过滤特殊字符

      - 使用HTTP头指定类型: 如在PHP中可以

        ```php
        <?php
           header('Content-Type: text/javascript; charset=utf-8');
        ?>
        ```

      - 关闭浏览器的Js选项

   2. SQL注入:

      攻击者在输入的字符串(如表单)内写入恶意sql语句,

      #### 解决方法:

      - 只用参数化查询来设计数据访问(Prepare Statement)
      - 在组合sql字符串时,  对特定字符进行转义等
      - 做好参数校验

   3. CSRF(跨站请求伪造攻击):

      是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。这利用了web中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。

      例如: 在一个图片点击后执行恶意脚本发送请求

      解决方法:

      - 用令牌(Token)进行认证, 而不是cookies, 每次请求的时候附加在body里面
      - 检查http请求的Referer字段