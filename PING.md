# PING

1. ### 工作模式:

   ping 命令是基于 ICMP 协议来工作的，「 ICMP 」全称为 Internet 控制报文协议。ping 命令会发送一份ICMP回显请求报文给目标主机，并等待目标主机返回ICMP回显应答

2. ### ICMP:

   网络层协议, 为IP协议的一部分, 通常用于返回的错误信息或是分析路由.

3. ### 工作流程:

   是有两个主机A, B

   1. 主机A ping 主机B
   2. 主机A构建ICMP(Echo Request)包, 并将这个ICMP包交给IP层(网路层)
   3. IP得到这个包后, 将本机地址, 目标地址等控制信息包装成IP数据包, 再交给链路层
   4. 链路层通过ARP协议找到目标机器的MAC地址, 并将数据包交给物理层
   5. 物理层将其转换为二进制包发出
   6. 目的主机收到Echo Request后发现IP包头的协议号为(1), 于是交给ICMP处理, ICMP收到后回复Echo reply
   7. 而如果到在传输过程路由器发现TTL=0则需要将数据包丢弃, 于是发送一个带有差错类型的ICMP reply



**ICMP协议既不是基于TCP，也不是基于UDP，而是直接基于网络层的IP协议，在整个网络协议栈中属于相当底层的协议了。这也从侧面证明了它的重要性，因为根据ICMP的RFC手册规定：ICMP协议是任何支持IP协议的系统必须实现的，没有余地。而IP协议是整个互联网的基石，ICMP协议虽简单，但重要性不言而喻**